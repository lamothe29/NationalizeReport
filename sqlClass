package studentMgmt;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;

public class Sql {
	
	
	 //Method to connect to SQLite
	 public static Connection connect() {
		    Connection con = null; 
		    try {
		      Class.forName("org.sqlite.JDBC");
		      con = DriverManager.getConnection("jdbc:sqlite:/Users/kylelamothe/Documents/SQLite/sample_data.sqlite"); // connecting to our database
		      System.out.println("Connected!");
		    } catch (ClassNotFoundException | SQLException e ) { System.out.println(e+"");
		    } return con; 
		  }
	 
	 
	 
	 //SQLite command to return data from database without phone extensions
	 public static ArrayList<Student> selectALL() throws SQLException {
		 	Connection con = Sql.connect();
			
		 	String sql1 = "SELECT stu_id, first_name, last_name, email, CASE WHEN phone LIKE '%x%' THEN substr(phone, 1, (instr(phone, 'x') -1 )) ELSE phone END AS phone, dob  FROM students;";
			Statement statement1 = con.createStatement();				 
			ResultSet result = statement1.executeQuery(sql1);
			ArrayList<Student> list = new ArrayList<Student>();
			while(result.next()) {
				
				Student bob = new Student();
				
				bob.studentID = result.getString("stu_id");
				bob.firstName = result.getString("first_name");
				bob.lastName = result.getString("last_name");
				bob.email = result.getString("email");
				bob.phone = result.getString("phone");
				bob.dob = result.getString("dob");	
				
				
				list.add(bob);
				
				}	return list;
	 }
	 
}

package studentMgmt;

import java.io.IOException;
import java.util.ArrayList;
import org.json.JSONException;
import com.opencsv.CSVWriter;
import java.io.File;
import java.io.FileWriter;
import java.sql.Connection;
import java.sql.SQLException;


public class Reporter {
	
	public static void main(String[] args) throws JSONException, SQLException, IOException, InterruptedException{
	
		
		//connecting to SQLite database
		Connection con = Sql.connect();
		
		//Initial list with student objects and data from database
		ArrayList<Student> students = Sql.selectALL(con);
		 
		
		//Preparing to create CSV file
		String filePath = "./project5.csv";
		File file = new File(filePath);
		
		String[] columnTitle = { "stu_id", "first_name", "last_name", "email", "phone", "dob", "country_id"};
		FileWriter outputFile = new FileWriter(file);
		CSVWriter writer = new CSVWriter(outputFile);
		writer.writeNext(columnTitle);
		
		

		Nationalize.APICall(students);
	
		
		
		//Now that the for loop is done, the students table should have all the info it needs
		//To write a CSV, we need arrays to enter as rows. So below I'm iterating through the students table and
		// and placing each property value in a column (an index of the array). Each array represents a student.
		
		for (int j =0; j < students.size(); j++) {
					
					
					String[] arr = new String[7];
					
					arr[0] = students.get(j).getStudentID();
					arr[1] = students.get(j).getFirstName();
					arr[2] = students.get(j).getLastName();
					arr[3] = students.get(j).getEmail();
					arr[4] = students.get(j).getPhone();
					arr[5] = students.get(j).getDob();
					arr[6] = students.get(j).getCountryID();
					
					writer.writeNext(arr);
		}  
		
				writer.close();
			
			}}
		
